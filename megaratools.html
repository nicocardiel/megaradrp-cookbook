

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MEGARA Tools &mdash; megara-cookbook 2025.05.16 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=cecfaa16"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Known ISSUES" href="issues.html" />
    <link rel="prev" title="Healing Defective Traces" href="healtraces.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            megara-cookbook
              <img src="_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="megaradrp.html">MEGARA Data Reduction Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">DRP installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="datadesc.html">Data description</a></li>
<li class="toctree-l1"><a class="reference internal" href="datared.html">Data reduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="healtraces.html">Healing Defective Traces</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">MEGARA Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#downloading-sample-data">Downloading sample data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#megaradrp-visualization">Megaradrp.Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#megaradrp-cube">Megaradrp-Cube</a></li>
<li class="toctree-l2"><a class="reference internal" href="#extract-spectrum-megaratools-extract-spectrum">Extract spectrum: megaratools-extract_spectrum</a></li>
<li class="toctree-l2"><a class="reference internal" href="#extract-elliptical-apertures-megaratools-extract-rings">Extract elliptical apertures: megaratools-extract_rings</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plot-spectrum-megaratools-plot-spectrum">Plot spectrum: megaratools-plot_spectrum</a></li>
<li class="toctree-l2"><a class="reference internal" href="#diffuse-light-determination-megaratools-diffuse-light">Diffuse light determination: megaratools-diffuse_light</a></li>
<li class="toctree-l2"><a class="reference internal" href="#analysis-of-a-1d-emission-line-spectrum-megaratools-analyze-spectrum">Analysis of a 1D emission-line spectrum: megaratools-analyze_spectrum</a></li>
<li class="toctree-l2"><a class="reference internal" href="#analysis-of-a-2d-rss-emission-line-spectrum-megaratools-analyze-rss">Analysis of a 2D RSS emission-line spectrum: megaratools-analyze_rss</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rss-arithmetics-megaratools-rss-arith">RSS arithmetics: megaratools-rss_arith</a></li>
<li class="toctree-l2"><a class="reference internal" href="#megaratools-hypercube">Megaratools-hypercube</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="issues.html">Known ISSUES</a></li>
<li class="toctree-l1"><a class="reference internal" href="acronyms.html">Acronyms</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">megara-cookbook</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">MEGARA Tools</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/megaratools.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="megara-tools">
<span id="id1"></span><h1>MEGARA Tools<a class="headerlink" href="#megara-tools" title="Link to this heading">ÔÉÅ</a></h1>
<p>In this section we describe a series of software tools that have been
developed by the MEGARA team and that can be used to visualize and
analyze the products of the MEGARA DRP. The first two tools
(visualization and cube) are already included as part of the MEGARA DRP
distribution. The rest conform their own software package
<strong>megara-tools</strong>, which is also available through GitHub at
<a class="reference external" href="https://github.com/guaix-ucm/megara-tools">https://github.com/guaix-ucm/megara-tools</a>. The installation requires to
follow one of these three strategies:</p>
<p>To install the latest stable version:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>pip<span class="w"> </span>install<span class="w"> </span>megara-tools<span class="o">[</span>hypercube<span class="o">]</span>

<span class="gp"># </span>Note:<span class="w"> </span>mac<span class="w"> </span>OS<span class="w"> </span>under<span class="w"> </span>zsh<span class="w"> </span>should<span class="w"> </span>use:
<span class="gp"># </span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span><span class="s2">&quot;megara-tools[hypercube]&quot;</span>
</pre></div>
</div>
<p>or, if you do not want <strong>hypercube</strong> to be installed (as it includes <a class="reference external" href="https://pysynphot.readthedocs.io/en/latest/">pysynphot</a> as a dependency, which is no
longer actively developed), simply do:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>pip<span class="w"> </span>install<span class="w"> </span>megara-tools
</pre></div>
</div>
<p>To install the development version:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>pip<span class="w"> </span>install<span class="w"> </span>git+https://github.com/guaix-ucm/megara-tools.git
</pre></div>
</div>
<p>To develop your own tools based on <strong>megara-tools</strong>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/guaix-ucm/megara-tools.git
<span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>megara-tools
<span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span>.
</pre></div>
</div>
<p>All tools described in this section should be under Python &gt;=3.5 and
should be run within the MEGARA DRP environment. For all tools besides
<code class="docutils literal notranslate"><span class="pre">megaratools-cube</span></code> and <code class="docutils literal notranslate"><span class="pre">megaratools-hypercube</span></code>, these can be run under
the <strong>megaradrp</strong> Python package (<strong>numina</strong> and <strong>megaradrp</strong> versions 0.21+
and 0.9+, respectively) or under the development version. For
<code class="docutils literal notranslate"><span class="pre">megaratools-cube</span></code> and <code class="docutils literal notranslate"><span class="pre">megaratools-hypercube</span></code>, the development version
or Python packages with release date after July 1<sup>st</sup> 2020
(<strong>numina</strong> and <strong>megaradrp</strong> versions 0.22+ and 0.10+, respectively) should
be used. All these tools have been extensively tested in Mac OS X (10.10
to 10.15) and linux machines. Some of the examples below make use of
<code class="docutils literal notranslate"><span class="pre">test/*</span></code> folder data that are downloaded when executing the code tests.</p>
<section id="downloading-sample-data">
<h2>Downloading sample data<a class="headerlink" href="#downloading-sample-data" title="Link to this heading">ÔÉÅ</a></h2>
<p>The sample data employed in this section is available at this link:
<a class="reference external" href="https://guaix.fis.ucm.es/data/megaradrp/test-megaratools_v1.tar.gz">test-megaratools_v1.tar.gz</a></p>
<p>If you find any trouble trying to download the previous file, try with the
following command line:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>curl<span class="w"> </span>-O<span class="w"> </span>https://guaix.fis.ucm.es/data/megaradrp/test-megaratools_v1.tar.gz
</pre></div>
</div>
<p>After decompressing and extracting the contents of this file, you should
generate a subdirectory <code class="docutils literal notranslate"><span class="pre">test/</span></code> with all the sample files required in the
following examples.</p>
</section>
<section id="megaradrp-visualization">
<h2>Megaradrp.Visualization<a class="headerlink" href="#megaradrp-visualization" title="Link to this heading">ÔÉÅ</a></h2>
<p>As part of the MEGARA DRP we also provide a tool to visualize the RSS
frames generated when processing LCB IFU data. This tool is best suited
for visualizing <code class="docutils literal notranslate"><span class="pre">final_rss.fits</span></code> RSS images (or, equivalently,
<code class="docutils literal notranslate"><span class="pre">reduced_rss.fits</span></code> images) obtained after running the <strong>MegaraLcbImage</strong>
processing recipe. The way to execute this code is to use the following
command under the corresponding MEGARA environment:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>megaradrp.visualization<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>test/final_rss_M32_MR-G.fits<span class="w"> </span>--label<span class="w"> </span><span class="s2">&quot;flux (Jy)&quot;</span><span class="w"> </span>--wcs-grid
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/image25.png"><img alt="_images/image25.png" src="_images/image25.png" style="width: 4.82196in; height: 3.19565in;" />
</a>
<p><strong>Figure 17:</strong> Example of reconstructed final_rss.fits (sky subtracted,
wavelength and flux calibrated) image of the center of Local Group
galaxy M32 in the MR-G setup. This image is generated using the
megaradrp.visualization code included in the MEGARA DRP distribution.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>megaradrp.visualization<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>test/final_rss_M15_HR-R.fits<span class="w"> </span>--label<span class="w"> </span><span class="s2">&quot;flux (Jy)&quot;</span><span class="w"> </span>--wcs-grid
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/image26.png"><img alt="_images/image26.png" src="_images/image26.png" style="width: 4.45528in; height: 3.11334in;" />
</a>
<p><strong>Figure 18:</strong> <em>Example of reconstructed final_rss.fits (sky subtracted,
wavelength and flux calibrated) image of the center of globular cluster
M15 in the HR-R setup. This image is generated using the
megaradrp-visualization code included in the MEGARA DRP distribution.</em></p>
<p><strong>Figures 17</strong> and <strong>18</strong> show two examples of the output generated by
this code for commissioning observations of Local Group galaxy M32 and
Galactic Globular Cluster M15, respectively.</p>
<p>As for the other commands, adding the -h flag would provide the help and
syntax for using this command. The result is the following:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>python<span class="w"> </span>-m<span class="w">  </span>megaradrp.visualization<span class="w"> </span>--help
<span class="go">usage: visualization.py [-h] [--wcs-grid] [--wcs-pa-from-header]</span>
<span class="go">                        [--fix-missing]</span>
<span class="go">                        [--average-region AVERAGE_REGION AVERAGE_REGION]</span>
<span class="go">                        [--extname EXTNAME] [--column COLUMN]</span>
<span class="go">                        [--continuum-region CONTINUUM_REGION CONTINUUM_REGION]</span>
<span class="go">                        [--coordinate-type {pixel,wcs}] [--colormap COLORMAP]</span>
<span class="go">                        [--plot-sky] [--display-fibid] [--plot-nominal-config]</span>
<span class="go">                        [--hide-values] [--title TITLE] [--label LABEL]</span>
<span class="go">                        [--hex-size HEX_SIZE] [--hex-rel-size HEX_REL_SIZE]</span>
<span class="go">                        [--min-cut MIN_CUT] [--max-cut MAX_CUT]</span>
<span class="go">                        [--percent PERCENT]</span>
<span class="go">                        [--stretch {linear,sqrt,power,log,asinh}]</span>
<span class="go">                        [--contour-pixel-size CONTOUR_PIXEL_SIZE]</span>
<span class="go">                        [--contour-levels CONTOUR_LEVELS] [--contour]</span>
<span class="go">                        [--contour-image CONTOUR_IMAGE]</span>
<span class="go">                        [--contour-image-column CONTOUR_IMAGE_COLUMN]</span>
<span class="go">                        [--contour-image-save CONTOUR_IMAGE_SAVE]</span>
<span class="go">                        [--contour-image-region CONTOUR_IMAGE_REGION CONTOUR_IMAGE_REGION]</span>
<span class="go">                        [--contour-is-density]</span>
<span class="go">                        RSS [RSS ...]</span>

<span class="go">Display MEGARA RSS images</span>

<span class="go">positional arguments:</span>
<span class="go">  RSS                   RSS images to process</span>

<span class="go">options:</span>
<span class="go">  -h, --help            show this help message and exit</span>
<span class="go">  --wcs-grid, --display-wcs-grid</span>
<span class="go">                        Display WCS grid</span>
<span class="go">  --wcs-pa-from-header  Use PA angle from PC keys</span>
<span class="go">  --fix-missing         Interpolate missing fibers</span>
<span class="go">  --average-region AVERAGE_REGION AVERAGE_REGION</span>
<span class="go">                        Region of the RSS averaged on display</span>
<span class="go">  --extname EXTNAME, -e EXTNAME</span>
<span class="go">                        Name of the extension used</span>
<span class="go">  --column COLUMN, -c COLUMN</span>
<span class="go">                        Column of the RSS on display</span>
<span class="go">  --continuum-region CONTINUUM_REGION CONTINUUM_REGION</span>
<span class="go">                        Region of the RSS used for continuum subtraction</span>
<span class="go">  --coordinate-type {pixel,wcs}</span>
<span class="go">                        Types of coordinates used</span>
<span class="go">  --colormap COLORMAP   Name of a valid matplotlib colormap</span>
<span class="go">  --plot-sky, --display-sky</span>
<span class="go">                        Display SKY bundles</span>
<span class="go">  --display-fibid, --plot-fibid</span>
<span class="go">                        Display fiber IDs of the spaxels</span>
<span class="go">  --plot-nominal-config</span>
<span class="go">                        Plot nominal configuration, do not use the header</span>
<span class="go">  --hide-values         Do not show values out of range</span>
<span class="go">  --title TITLE         Title of the plot</span>
<span class="go">  --label LABEL         Legend of the colorbar</span>
<span class="go">  --hex-size HEX_SIZE   Size of the hexagons (default is 0.443)</span>
<span class="go">  --hex-rel-size HEX_REL_SIZE</span>
<span class="go">                        Scale the size of hexagons by a factor</span>
<span class="go">  --min-cut MIN_CUT     Inferior cut level</span>
<span class="go">  --max-cut MAX_CUT     Superior cut level</span>
<span class="go">  --percent PERCENT     Compute cuts using percentiles</span>
<span class="go">  --stretch {linear,sqrt,power,log,asinh}</span>
<span class="go">                        Name of the strech method used for display</span>

<span class="go">contouring:</span>
<span class="go">  --contour-pixel-size CONTOUR_PIXEL_SIZE</span>
<span class="go">                        Pixel size in arc seconds for image reconstruction</span>
<span class="go">  --contour-levels CONTOUR_LEVELS</span>
<span class="go">                        Contour levels</span>
<span class="go">  --contour             Draw contours</span>
<span class="go">  --contour-image CONTOUR_IMAGE</span>
<span class="go">                        Image for computing contours</span>
<span class="go">  --contour-image-column CONTOUR_IMAGE_COLUMN</span>
<span class="go">                        Column of image used for contouring</span>
<span class="go">  --contour-image-save CONTOUR_IMAGE_SAVE</span>
<span class="go">                        Save image used for contouring</span>
<span class="go">  --contour-image-region CONTOUR_IMAGE_REGION CONTOUR_IMAGE_REGION</span>
<span class="go">                        Region of the image used for contouring</span>
<span class="go">  --contour-is-density  The data is a magnitude that does not require scaling</span>
</pre></div>
</div>
<p>Note that this visualization tool can be also used to display output RSS
files from the <code class="docutils literal notranslate"><span class="pre">analyze_rss.py</span></code> tool described below. As an example, the
command to display the flux the first of the two gaussians fit to a
specific emission line analyzed with that code would be (see Section
6.8):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>megaradrp.visualization<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>test/analyze_rss_Halpha.fits<span class="w"> </span>-c<span class="w"> </span><span class="m">22</span><span class="w"> </span>--min-cut<span class="w"> </span><span class="m">10</span>.<span class="w"> </span>--max-cut<span class="w"> </span><span class="m">400</span>.
</pre></div>
</div>
</section>
<section id="megaradrp-cube">
<h2>Megaradrp-Cube<a class="headerlink" href="#megaradrp-cube" title="Link to this heading">ÔÉÅ</a></h2>
<p>This tool allows to conver the output RSS file from the MegaraLcbImage
recipe (with or without the sky spectrum subtracted) into a FITS
datacube (x,y,z) where the z axis corresponds to every lambda in the
input RSS file and the (x,y) axes correspond to the two coordinates in
the sky (RA &amp; Dec if instrument PA is 0¬∫). Since this tool is now part
of the MEGARA DRP it should be run from within the DRP environment by
doing:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>megaradrp-cube<span class="w"> </span>-h
<span class="go">usage: convert_rss_cube [-h] [-p PIXEL_SIZE] [-o OUTFILE] [-d]</span>
<span class="go">                        [-m {nn,linear}] [--wcs-pa-from-header]</span>
<span class="go">                        [--fix-missing]</span>
<span class="go">                        rss</span>

<span class="go">positional arguments:</span>
<span class="go">  rss                   RSS file with fiber traces</span>

<span class="go">options:</span>
<span class="go">  -h, --help            show this help message and exit</span>
<span class="go">  -p PIXEL_SIZE, --pixel-size PIXEL_SIZE</span>
<span class="go">                        Pixel size in arc seconds</span>
<span class="go">  -o OUTFILE, --outfile OUTFILE</span>
<span class="go">                        Name of the output cube file</span>
<span class="go">  -d, --disable-scaling</span>
<span class="go">                        Disable flux conservation</span>
<span class="go">  -m {nn,linear}, --method {nn,linear}</span>
<span class="go">                        Method of interpolation</span>
<span class="go">  --wcs-pa-from-header  Use PA angle from header</span>
<span class="go">  --fix-missing         Interpolate missing fibers</span>
</pre></div>
</div>
<p>Default parameters for the <code class="docutils literal notranslate"><span class="pre">--disable-scaling</span></code> and <code class="docutils literal notranslate"><span class="pre">--wcs-pa-from-header</span></code>
options should be fine for regular MEGARA data processed with the DRP.</p>
<p>An alternative software with similar scope has been developed by Javier
Zaragoza Cardiel (from INAOE) and can be obtained through GitHub at
<a class="reference external" href="https://github.com/javierzaragoza/megararss2cube">https://github.com/javierzaragoza/megararss2cube</a>.</p>
</section>
<section id="extract-spectrum-megaratools-extract-spectrum">
<span id="megaratools-extract-spectrum"></span><h2>Extract spectrum: megaratools-extract_spectrum<a class="headerlink" href="#extract-spectrum-megaratools-extract-spectrum" title="Link to this heading">ÔÉÅ</a></h2>
<p>This tool is the first being described in this cookbook that is part of
the <strong>megaratools</strong> package available through GitHub at
<a class="reference external" href="https://github.com/guaix-ucm/megara-tools">https://github.com/guaix-ucm/megara-tools</a>. The objective of this tool is
to generate an extracted (1D) spectrum of a given fiber or set of
fibers. The main parameter determining the fiber(s) to be extracted is
the fiber number as measured in the pseudo-slit (from 1 to 623 in the
case of the LCB; 1 to 644 for the MOS). Since the RSS products of the
<strong>MegaraMosImage</strong> recipe already include an extension with the 7 fibers of
the each minibundle added together, this is particularly useful for
extracting spectra of different regions from processed LCB RSS frames.
The resulting extracted spectrum shares wavelength calibration solution
with the RSS. All tools included in the <strong>megaratools</strong> package can be
called as an argument for the Python main interpreter or as executables
on their own, although the latter option is recommended:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>python<span class="w"> </span>&lt;path_to_extract_spectrum&gt;/extract_spectrum.py<span class="w"> </span>-h

<span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>megaratools-extract_spectrum<span class="w"> </span>-h
</pre></div>
</div>
<p>The result of the task when called using the help (-h) argument is:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">usage: extract_spectrum [-h] [-s RSS-SPECTRUM] [-t INPUT-TABLE] [-c COLUMN]</span>
<span class="go">                        [-g GREP-STRING] [-o OUTPUT-SPECTRUM] [-p]</span>

<span class="go">Extract spectrum based on fiber IDs</span>

<span class="go">options:</span>
<span class="go">  -h, --help            show this help message and exit</span>
<span class="go">  -s RSS-SPECTRUM, --spectrum RSS-SPECTRUM</span>
<span class="go">                        RSS FITS spectrum</span>
<span class="go">  -t INPUT-TABLE, --ids-table INPUT-TABLE</span>
<span class="go">                        File with list of IDs</span>
<span class="go">  -c COLUMN, --column COLUMN</span>
<span class="go">                        Column to select from table</span>
<span class="go">  -g GREP-STRING, --grep-string GREP-STRING</span>
<span class="go">                        String to do grep in table</span>
<span class="go">  -o OUTPUT-SPECTRUM, --output OUTPUT-SPECTRUM</span>
<span class="go">                        Output 1D spectrum</span>
<span class="go">  -p, --plot            Plot spectrum instead?</span>
</pre></div>
</div>
<p>The table with the fiber ids (<code class="docutils literal notranslate"><span class="pre">-t</span></code>) is a simple ASCII file in which one of
the (space-separated) columns is the fiber id. The user can also choose
a set of rows that fulfils the condition of including a specific string
(using <code class="docutils literal notranslate"><span class="pre">-g</span></code>). An example of a file like this could be:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>cat<span class="w"> </span>test/regions.fibers
<span class="go">Region1 321</span>
<span class="go">Region1 319</span>
<span class="go">Region2 454</span>
<span class="go">Region2 460</span>
<span class="go">Region2 474</span>
</pre></div>
</div>
<p>Should be the user be interested in extracting the fibers corresponding
to Region #2 (fibers 454, 460 &amp; 474) from <code class="docutils literal notranslate"><span class="pre">final_rss.fits</span></code> file in the
<code class="docutils literal notranslate"><span class="pre">test/</span></code> directory to a <code class="docutils literal notranslate"><span class="pre">Region2.fits</span></code> file, he/she can simply run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>megaratools-extract_spectrum<span class="w"> </span>-s<span class="w"> </span>test/final_rss.fits<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-t<span class="w"> </span>test/regions.fibers<span class="w"> </span>-c<span class="w"> </span><span class="m">2</span><span class="w"> </span>-g<span class="w"> </span>Region2<span class="w"> </span>-o<span class="w"> </span>test/Region2.fits
</pre></div>
</div>
<p>The user can also decide to visualize the extracted spectrum without
saving it as a new FITS file. In that case he/she should make use of the
<cite>-p</cite> option:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>megaratools-extract_spectrum<span class="w"> </span>-s<span class="w"> </span>test/final_rss.fits<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-t<span class="w"> </span>test/regions.fibers<span class="w"> </span>-c<span class="w"> </span><span class="m">2</span><span class="w"> </span>-g<span class="w"> </span>Region2<span class="w"> </span>-p
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/spectrum_Region2.png"><img alt="_images/spectrum_Region2.png" src="_images/spectrum_Region2.png" style="width: 4.45528in;" />
</a>
<p>One of the uses of this tool is to extract the spectrum of the
(flux-calibrated) <code class="docutils literal notranslate"><span class="pre">final_rss.fits</span></code> of a standard star processed with
MegaraLcbImage to verify that it matches the corresponding tabulated
spectrum. This extraction can be done using the <code class="docutils literal notranslate"><span class="pre">fiber_ids.txt</span></code> file
that it is stored in the <code class="docutils literal notranslate"><span class="pre">*_results/</span></code> directory generated by the MEGARA
DRP when running this recipe. In the case the command would read (using
two single quotes for the <code class="docutils literal notranslate"><span class="pre">-g</span></code> option we ensure that the command selects
all rows extraction):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>megaratools-extract_spectrum<span class="w"> </span>-s<span class="w"> </span>test/final_rss.fits<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-t<span class="w"> </span>test/fiber_ids.txt<span class="w"> </span>-c<span class="w"> </span><span class="m">1</span><span class="w"> </span>-g<span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span>-p
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/spectrum_final_rss.png"><img alt="_images/spectrum_final_rss.png" src="_images/spectrum_final_rss.png" style="width: 4.45528in;" />
</a>
</section>
<section id="extract-elliptical-apertures-megaratools-extract-rings">
<h2>Extract elliptical apertures: megaratools-extract_rings<a class="headerlink" href="#extract-elliptical-apertures-megaratools-extract-rings" title="Link to this heading">ÔÉÅ</a></h2>
<p>This tool (also part of <strong>megara-tools</strong>) is similar to the previous one
but allows to automatically extract spectra of elliptical rings or
arbitrary size, orientation and ellipticity around a given position
(fiber). This is particularly useful of the analysis the radial
variation of properties derived from RSS data when the signal-to-noise
ratio does not allow to carry out a spaxel-by-spaxel analysis. The
options for this command are:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>megaratools-extract_rings<span class="w"> </span>-h
<span class="go">usage: extract_elliptical_rings_spectrum [-h] [-r RSS-SPECTRUM] [-a] [-b]</span>
<span class="go">                                         [-c CENTRAL-FIBER] [-n NUMBER-RINGS]</span>
<span class="go">                                         [-w RINGS WIDTH] [-s SAVED-RSS]</span>
<span class="go">                                         [-e ELLIPTICITY] [-pa POSITION ANGLE]</span>
<span class="go">                                         [-v]</span>

<span class="go">Extract spectra based on elliptical rings</span>

<span class="go">options:</span>
<span class="go">  -h, --help            show this help message and exit</span>
<span class="go">  -r RSS-SPECTRUM, --rss RSS-SPECTRUM</span>
<span class="go">                        RSS FITS spectrum</span>
<span class="go">  -a, --accumulate</span>
<span class="go">  -b, --surface_brightness</span>
<span class="go">  -c CENTRAL-FIBER, --central-fiber CENTRAL-FIBER</span>
<span class="go">                        Central fiber</span>
<span class="go">  -n NUMBER-RINGS, --number-rings NUMBER-RINGS</span>
<span class="go">                        Number of rings</span>
<span class="go">  -w RINGS WIDTH, --width RINGS WIDTH</span>
<span class="go">                        Elliptical rings width (arcsec)</span>
<span class="go">  -s SAVED-RSS, --saved-rss SAVED-RSS</span>
<span class="go">                        Output RSS file</span>
<span class="go">  -e ELLIPTICITY, --ellipticity ELLIPTICITY</span>
<span class="go">                        Elliptical rings ellipticity</span>
<span class="go">  -pa POSITION ANGLE, --position-angle POSITION ANGLE</span>
<span class="go">                        Elliptical rings position angle (N-&gt;E)</span>
<span class="go">  -v, --verbose</span>
</pre></div>
</div>
<p>The command creates an RSS file with the same wavelength calibration
solution as the input RSS file but a number of columns equal to the
number of rings extracted (as set by the <code class="docutils literal notranslate"><span class="pre">-n</span></code> option). Besides, this
command when run with the verbose option (<code class="docutils literal notranslate"><span class="pre">-v</span></code>) on it also outputs the
main parameters of the rings extracted: average surface brightness at
the central wavelength (in Jy/spx or Jy/arcsec<sup>2</sup> if the <code class="docutils literal notranslate"><span class="pre">-b</span></code>
option is set) and area. Below, we show an example of how this command
is run and of the output it creates in verbose mode.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>megaratools-extract_rings<span class="w"> </span>-r<span class="w"> </span>test/final_rss.fits<span class="w"> </span>-c<span class="w"> </span><span class="m">311</span><span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-b<span class="w"> </span>-w<span class="w"> </span><span class="m">0</span>.6<span class="w"> </span>-n<span class="w"> </span><span class="m">5</span><span class="w"> </span>-s<span class="w"> </span>test/rings.fits<span class="w"> </span>-e<span class="w"> </span><span class="m">0</span>.8<span class="w"> </span>-pa<span class="w"> </span><span class="m">0</span>.<span class="w"> </span>-v

<span class="go">Ring #1: 0.010272977933 Jy/[asec/spx]^2 (@CWL) - area/rad: 1.1618385/0.3 [asec/spx]^2/asec)</span>
<span class="go">Ring #2: 0.006704834831 Jy/[asec/spx]^2 (@CWL) - area/rad: 3.3284848/0.9 [asec/spx]^2/asec)</span>
<span class="go">Ring #3: 0.002757987470 Jy/[asec/spx]^2 (@CWL) - area/rad: 4.1630143/1.5 [asec/spx]^2/asec)</span>
<span class="go">Ring #4: 0.001841463727 Jy/[asec/spx]^2 (@CWL) - area/rad: 6.5997403/2.1 [asec/spx]^2/asec)</span>
<span class="go">Ring #5: 0.001480577862 Jy/[asec/spx]^2 (@CWL) - area/rad: 9.4244147/2.7 [asec/spx]^2/asec)</span>
</pre></div>
</div>
<p>Note that this tool can be also used to add the fluxes within (complete)
elliptical apertures, not only rings by using the <code class="docutils literal notranslate"><span class="pre">-a</span></code> option. The
resulting RSS can be used to extract the spectra of each ring/aperture
by combining its use with the <code class="docutils literal notranslate"><span class="pre">megaratools-extract_spectrum</span></code> tool
described in Section <a class="reference internal" href="#megaratools-extract-spectrum"><span class="std std-ref">Extract spectrum: megaratools-extract_spectrum</span></a>.
Examples of that use are:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>megaratools-extract_spectrum<span class="w"> </span>-s<span class="w"> </span>test/final_rss.fits<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-t<span class="w"> </span>test/rings.dat<span class="w"> </span>-c<span class="w"> </span><span class="m">1</span><span class="w"> </span>-g<span class="w"> </span><span class="m">1</span><span class="w"> </span>-o<span class="w"> </span>test/ring1.fits
<span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>megaratools-extract_spectrum<span class="w"> </span>-s<span class="w"> </span>test/final_rss.fits<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-t<span class="w"> </span>test/rings.dat<span class="w"> </span>-c<span class="w"> </span><span class="m">1</span><span class="w"> </span>-g<span class="w"> </span><span class="m">2</span><span class="w"> </span>-o<span class="w"> </span>test/ring2.fits
<span class="go">...</span>
</pre></div>
</div>
<p>where the <code class="docutils literal notranslate"><span class="pre">test/rings.dat</span></code> file is simply a list of integer numbers.</p>
</section>
<section id="plot-spectrum-megaratools-plot-spectrum">
<h2>Plot spectrum: megaratools-plot_spectrum<a class="headerlink" href="#plot-spectrum-megaratools-plot-spectrum" title="Link to this heading">ÔÉÅ</a></h2>
<p>This tool allows to plot a 1D MEGARA spectrum. It also allows to combine
the spectrum plotted with a tabulated spectrum (e.g. that from a
standard star) and a list of spectral lines. The options that can be
used for the <code class="docutils literal notranslate"><span class="pre">megaratools-plot_spectrum</span></code> tool are:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>megaratools-plot_spectrum<span class="w"> </span>-h
<span class="go">usage: plot_spectrum [-h] [-s SPECTRUM/FILE_LIST] [-l] [-t STD-TABLE]</span>
<span class="go">                     [-c LINECAT-TABLE] [-z LINECAT-Z] [-o OUTPUT-PDF] [-e]</span>
<span class="go">                     [-p] [-n] [-L1 INITIAL LAMBDA] [-L2 LAST LAMBDA]</span>
<span class="go">                     [-F1 YMIN FLUX] [-F2 YMAX FLUX] [-T PLOT TITLE]</span>

<span class="go">Input spectrum and table</span>

<span class="go">options:</span>
<span class="go">  -h, --help            show this help message and exit</span>
<span class="go">  -s SPECTRUM/FILE_LIST, --spectrum SPECTRUM/FILE_LIST</span>
<span class="go">                        FITS spectrum / list of FITS spectra</span>
<span class="go">  -l, --is-a-list       Use for -s being a list of FITS spectra</span>
<span class="go">  -t STD-TABLE, --std-table STD-TABLE</span>
<span class="go">                        Standard-star spectrum table</span>
<span class="go">  -c LINECAT-TABLE, --catalog LINECAT-TABLE</span>
<span class="go">                        Cataloged lines CSV table</span>
<span class="go">  -z LINECAT-Z, --redshift LINECAT-Z</span>
<span class="go">                        Redshift for catalog lines</span>
<span class="go">  -o OUTPUT-PDF, --output OUTPUT-PDF</span>
<span class="go">                        Output PDF</span>
<span class="go">  -e, --efficiency      Efficiency?</span>
<span class="go">  -p, --plot            Plot spectrum?</span>
<span class="go">  -n, --no-legend       Legend?</span>
<span class="go">  -L1 INITIAL LAMBDA, --min-lambda INITIAL LAMBDA</span>
<span class="go">                        Initial (rest-frame) lambda to plot</span>
<span class="go">  -L2 LAST LAMBDA, --max-lambda LAST LAMBDA</span>
<span class="go">                        Last (rest-frame) lambda to plot</span>
<span class="go">  -F1 YMIN FLUX, --min-flambda YMIN FLUX</span>
<span class="go">                        Minimum flux to plot</span>
<span class="go">  -F2 YMAX FLUX, --max-flambda YMAX FLUX</span>
<span class="go">                        Maximum flux to plot</span>
<span class="go">  -T PLOT TITLE, --title PLOT TITLE</span>
<span class="go">                        Title of the plot</span>
</pre></div>
</div>
<p>Below we show an example of its use and the resulting plot (<strong>Figure
19</strong>).</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>megaratools-plot_spectrum<span class="w"> </span>-s<span class="w"> </span>test/spectrum.fits<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-t<span class="w"> </span>test/mbd33d2642.dat<span class="w"> </span>-p<span class="w"> </span>-T<span class="w"> </span><span class="s1">&#39;BD+33 2642 spectrum&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-L1<span class="w"> </span><span class="m">6000</span><span class="w"> </span>-L2<span class="w"> </span><span class="m">7500</span><span class="w"> </span>-F1<span class="w"> </span>2E-14<span class="w"> </span>-F2<span class="w"> </span>2E-13<span class="w"> </span>-c<span class="w"> </span>test/bright_lines.dat
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/image27.png"><img alt="Imagen que contiene mapa Descripci√≥n generada autom√°ticamente" src="_images/image27.png" style="width: 4.31709in; height: 3.03846in;" />
</a>
<p><strong>Figure 19:</strong> Result of the megaratools-plot_spectrum of standard star
BD+33 2642 along with the CALSPEC tabulated spectrum and a series of
spectral lines at the recession velocity of the source.</p>
<p>The tabulated spectrum is assumed to be in AB magnitudes and the file
with a catalogue of spectral lines must have the following format:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>cat<span class="w"> </span>test/bright_lines.dat
<span class="go">[N II],6548.1</span>
<span class="go">Ha,6562.8</span>
<span class="go">[N II],6583.4</span>
<span class="go">[S II],6716.3</span>
<span class="go">[S II],6730.7</span>
</pre></div>
</div>
<p>Along with the input spectrum, <code class="docutils literal notranslate"><span class="pre">megaratools-plot_spectrum</span></code> also shows
(see <strong>Figure 19</strong>) the wavelength limits corresponding to the spectral
range that is common to all fibers (cyan lines) and that where the
computation (smoothing) of the sensitivity curve yields a reliable flux
calibration (dashed red lines). In that regard, it is also worth noting
that this tool can be also used to plot efficiency curves generated by
the LcbStdStar recipe (e.g. <code class="docutils literal notranslate"><span class="pre">master_sensitivity.fits</span></code>), as shown in
<strong>Figure 14</strong>, both in their nominal units (electrons/Jy) or in relative
efficiency (when the option <code class="docutils literal notranslate"><span class="pre">-e</span></code> is used) assuming 80% pupil losses and
80% telescope efficiency relative to its effective area.</p>
</section>
<section id="diffuse-light-determination-megaratools-diffuse-light">
<h2>Diffuse light determination: megaratools-diffuse_light<a class="headerlink" href="#diffuse-light-determination-megaratools-diffuse-light" title="Link to this heading">ÔÉÅ</a></h2>
<p>In some MEGARA observations taken under bright moon conditions during
2018 and 2019 some reflected moonlight did manage to reach the
spectrograph camera and the detector. This diffuse light appeared as a
low-frequency pattern that could amount from just a few to tens of
counts (see top-left panel of <strong>Figure 20</strong>). This tool fits this
pattern using information from the region of the CCD that is not
illuminated by the fibers below and above the pseudo-slit and in between
the boxes that constitute it. <strong>Figure 21</strong> shows the result of the fit
of an average of 50 columns to a 4<sup>th</sup>-order
polynomial to the flux of regions illuminated by diffuse light alone.</p>
<p><a class="reference internal" href="_images/image28.png"><img alt="Diffuse light 1 of 4" src="_images/image28.png" style="width: 3.35556in; height: 3.38542in;" /></a><a class="reference internal" href="_images/image29.png"><img alt="Diffuse light 2 of 4" src="_images/image29.png" style="width: 3.38592in; height: 3.39471in;" /></a></p>
<p><a class="reference internal" href="_images/image30.png"><img alt="Diffuse light 3 of 4" src="_images/image30.png" style="width: 3.37205in; height: 3.36751in;" /></a><a class="reference internal" href="_images/image31.png"><img alt="Diffuse light 4 of 4" src="_images/image31.png" style="width: 3.38422in; height: 3.40178in;" /></a></p>
<p><strong>Figure 20:</strong> Example of an image with diffuse light contamination
(top-left panel). The residuals after the best fit in 2D is performed is
shown in the top-right panel. Low-frequency background models obtained
by fitting only columns (left) and in 2D (columns first, then columns)
(right) are in the bottom panels.</p>
<p>Below we show how this tool is executed and some basic information on
its different options.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>megaratools-diffuse_light<span class="w"> </span>-h
<span class="go">usage: clean_diffuse_light [-h] [-i INPUT-IMAGE] [-o OUTPUT-IMAGE]</span>
<span class="go">                           [-r RESIDUALS-IMAGE] [-t MASTER-TRACES]</span>
<span class="go">                           [-s SHIFT-TRACES] [-w SEARCH-WINDOW]</span>
<span class="go">                           [-d DEGREE-POLY-COLS] [-d2 DEGREE-POLY-ROWS]</span>
<span class="go">                           [-p OUTPUT-PLOT] [-b SPECTRAL-BINNING]</span>
<span class="go">                           [-e EXCLUDE-REGION [EXCLUDE-REGION ...]] [-2D]</span>

<span class="go">Cleaning of diffuse light from a reduced (non-RSS) MEGARA image</span>

<span class="go">options:</span>
<span class="go">  -h, --help            show this help message and exit</span>
<span class="go">  -i INPUT-IMAGE, --input INPUT-IMAGE</span>
<span class="go">                        Reduced FITS image</span>
<span class="go">  -o OUTPUT-IMAGE, --output OUTPUT-IMAGE</span>
<span class="go">                        Output diffuse-light FITS image</span>
<span class="go">  -r RESIDUALS-IMAGE, --residuals RESIDUALS-IMAGE</span>
<span class="go">                        Output residual FITS image</span>
<span class="go">  -t MASTER-TRACES, --traces MASTER-TRACES</span>
<span class="go">                        Master traces JSON file</span>
<span class="go">  -s SHIFT-TRACES, --shift SHIFT-TRACES</span>
<span class="go">                        Traces shift</span>
<span class="go">  -w SEARCH-WINDOW, --window SEARCH-WINDOW</span>
<span class="go">                        Window around traces to search for non-illuminated</span>
<span class="go">                        fibers</span>
<span class="go">  -d DEGREE-POLY-COLS, --degree DEGREE-POLY-COLS</span>
<span class="go">                        Degree of polynomial fit for columns</span>
<span class="go">  -d2 DEGREE-POLY-ROWS, --degree-rows DEGREE-POLY-ROWS</span>
<span class="go">                        Degree of polynomial fit for rows</span>
<span class="go">  -p OUTPUT-PLOT, --outplot OUTPUT-PLOT</span>
<span class="go">                        Output plots</span>
<span class="go">  -b SPECTRAL-BINNING, --binning SPECTRAL-BINNING</span>
<span class="go">                        Binning in the spectral direction</span>
<span class="go">  -e EXCLUDE-REGION [EXCLUDE-REGION ...], --exclude EXCLUDE-REGION [EXCLUDE-REGION ...]</span>
<span class="go">                        Exclude region (c1 c2 r1 r2), e.g. 2407 2720 0 164</span>
<span class="go">  -2D, --two-dimensional</span>
<span class="go">                        Two-dimensional fitting?</span>
</pre></div>
</div>
<p>Most of these options are related to the different fitting parameters
used. Note that the input image should be the <code class="docutils literal notranslate"><span class="pre">reduced_image.fits</span></code> image
generated by, among others, the <strong>MegaraLcbImage</strong> and <strong>MegaraMosImage</strong>
recipes, that is place in the corresponding <code class="docutils literal notranslate"><span class="pre">\*_work/</span></code> directory. This
cannot be run on raw images as those have different bias levels and
gains for its two amplifiers. A master-traces file and the offset
between them and the position of the fibers in the contaminated image
should be provided as well (options <code class="docutils literal notranslate"><span class="pre">-t</span></code> and <code class="docutils literal notranslate"><span class="pre">-s</span></code>, respectively).</p>
<p><a class="reference internal" href="_images/image32.png"><img alt="Fit to the sum of 50 columns" src="_images/image32.png" style="width: 3.3in;" /></a><a class="reference internal" href="_images/image33.png"><img alt="image13" src="_images/image33.png" style="width: 3.9in;" /></a></p>
<p><strong>Figure 21:</strong> Fit to the sum of 50 columns (left) and 50 rows (right)
for a reduced_image.fits contaminated by diffuse light. The 2D fit
ensures that potential bright lines (peak in the right-panel profile) do
not significantly affect the modeling results. Black points correspond
to those pixels used to perform this fit. A fourth-order polynomial was
used in these fits.</p>
<p>Option <code class="docutils literal notranslate"><span class="pre">-e</span></code> (defined in pixels) allows to exclude a specific region from
the fit (white rectangle in top-right panel of <strong>Figure 20</strong>). This is
particularly useful from some very early observations in the red (LR-R,
MR-R, MR-RI) in which light from the pseudo-slit mechanism LED was
adding some diffuse light just below the position of the spectra on the
CCD but not the under the light from the fibers itself, making this
region not useful to fit any low-frequency pattern present throughout
the entire CCD. An example of the use of this tool follows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>megaratools-diffuse_light<span class="w"> </span>-i<span class="w"> </span>test/reduced_image.fits<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-o<span class="w"> </span>test/background_2D.fits<span class="w"> </span>-r<span class="w"> </span>test/residuals_2D.fits<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-t<span class="w"> </span>test/master_traces.json<span class="w"> </span>-s<span class="w"> </span><span class="m">1</span>.2<span class="w"> </span>-p<span class="w"> </span>test/plots_2D.pdf<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-e<span class="w"> </span><span class="m">2407</span><span class="w"> </span><span class="m">2720</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">154</span><span class="w"> </span>-2D
</pre></div>
</div>
<p>The result of this command is a low-frequency background image (the one
set by the <code class="docutils literal notranslate"><span class="pre">-o</span></code> option). See the bottom panels of <strong>Figure 20</strong> in this
regard, for the best fit along columns only (left panel) and fitting the
result also along rows (right panel). In order to remove this image
during the data processing with the DRP, both the MegaraLcbImage and
MegaraMosImage count with a <code class="docutils literal notranslate"><span class="pre">requirement</span></code> called <code class="docutils literal notranslate"><span class="pre">diffuse_light_image</span></code>
that should be set to the image resulting from this tool. That image
should be placed under the <code class="docutils literal notranslate"><span class="pre">data/*</span></code> directory where the <strong>megaradrp</strong> is
being run. This requirement is added in the development versions of the
<strong>megaradrp</strong> or in Python package versions released after July
1<sup>st</sup> 2020 (<strong>numina</strong> and <strong>megaradrp</strong> versions 0.22+ and 0.10+,
respectively). The user can find more info on the set of requirements of
these tasks by doing:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>numina<span class="w"> </span>show-recipes<span class="w"> </span>-m<span class="w"> </span>MegaraLcbImage
</pre></div>
</div>
<p>This tool also generates a clean image that, although of no use within
the <strong>megaradrp</strong>, can be used to verify the quality of the low-frequency
background modeling performed (see bottom panel of <strong>Figure 20</strong>).
Output background images generated by <code class="docutils literal notranslate"><span class="pre">megaratools-diffuse_light</span></code> have
keyword NUM-DFL added to their headers.</p>
</section>
<section id="analysis-of-a-1d-emission-line-spectrum-megaratools-analyze-spectrum">
<h2>Analysis of a 1D emission-line spectrum: megaratools-analyze_spectrum<a class="headerlink" href="#analysis-of-a-1d-emission-line-spectrum-megaratools-analyze-spectrum" title="Link to this heading">ÔÉÅ</a></h2>
<p>There are multiple tools that perform the analysis of spectral of
astronomical sources, both the stellar continuum and emission lines
(pPXF, Steckmap, Fit3D, FADO, to name a few). However, most of these
software tools do not work right away on data from a new instrument,
although many started from the need of analyzing data from a specific
spectrograph and survey, such as SAURON (pPXF) or PPaK/CALIFA (Fit3D).
In the case of MEGARA three different tools are used, one that is based
on pPXF (see e.g. <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2019ApJ...871....9D/abstract">Dullo et al.
2019</a>;
not yet public) and two that are designed for the analysis of single
emission lines on extracted 1D (<code class="docutils literal notranslate"><span class="pre">megaratools-analyze_spectrum</span></code>, below)
and RSS 2D MEGARA spectra (<code class="docutils literal notranslate"><span class="pre">megaratools-analyze_rss</span></code>, Section 6.8).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">megaratools-analyze_spectrum</span></code> tool allows to determine all
parameters of a specific emission lines by fitting different functions
(linear continuum plus a modelled single gaussian, double gaussian or
Gauss-Hermite polynomials to a single emission line) within a given
spectral range. As this tool is used on extracted 1D spectrum, the
output is given on the screen and no output file is created. This tool
is executed by doing:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>megaratools-analyze_spectrum<span class="w"> </span>-h
<span class="go">usage: analyze_spectrum [-h] [-s SPECTRUM/FILE_LIST] [-l]</span>
<span class="go">                        [-f FITTING FUNCTION (0,1,2)]</span>
<span class="go">                        [-w LINE CENTRAL WAVELENGTH] [-k]</span>
<span class="go">                        [-LW1 LOWER WAVELENGTH - LINE]</span>
<span class="go">                        [-LW2 UPPER WAVELENGTH - LINE]</span>
<span class="go">                        [-CW1 LOWER WAVELENGTH - CONT]</span>
<span class="go">                        [-CW2 UPPER WAVELENGTH - CONT]</span>
<span class="go">                        [-ECW1 EXCLUDE FROM CONT. (LOWER WAVELENGTH)]</span>
<span class="go">                        [-ECW2 EXCLUDE FROM CONT. (UPPER WAVELENGTH)]</span>
<span class="go">                        [-PW1 LOWER WAVELENGTH - PLOT]</span>
<span class="go">                        [-PW2 UPPER WAVELENGTH - PLOT]</span>
<span class="go">                        [-S2 SCALE FACTOR FOR AMP2] [-t SPEC-TABLE]</span>
<span class="go">                        [-c LINECAT-TABLE] [-z REDSHIFT] [-o OUTPUT-PDF] [-p]</span>
<span class="go">                        [-n]</span>

<span class="go">ANALYZE SPECTRUM</span>

<span class="go">options:</span>
<span class="go">  -h, --help            show this help message and exit</span>
<span class="go">  -s SPECTRUM/FILE_LIST, --spectrum SPECTRUM/FILE_LIST</span>
<span class="go">                        FITS spectrum / list of FITS spectra</span>
<span class="go">  -l, --is-a-list       Use for -s being a list of FITS spectra</span>
<span class="go">  -f FITTING FUNCTION (0,1,2), --method FITTING FUNCTION (0,1,2)</span>
<span class="go">                        Fitting function (0=gauss_hermite, 1=gauss,</span>
<span class="go">                        2=double_gauss)</span>
<span class="go">  -w LINE CENTRAL WAVELENGTH, --ctwl LINE CENTRAL WAVELENGTH</span>
<span class="go">                        Central rest-frame wavelength for line (AA)</span>
<span class="go">  -k, --use-peak        Use peak first guess on central wavelength</span>
<span class="go">  -LW1 LOWER WAVELENGTH - LINE, --lcut1 LOWER WAVELENGTH - LINE</span>
<span class="go">                        Lower rest-frame wavelength for line (AA)</span>
<span class="go">  -LW2 UPPER WAVELENGTH - LINE, --lcut2 UPPER WAVELENGTH - LINE</span>
<span class="go">                        Upper rest-frame wavelength for line (AA)</span>
<span class="go">  -CW1 LOWER WAVELENGTH - CONT, --ccut1 LOWER WAVELENGTH - CONT</span>
<span class="go">                        Lower rest-frame wavelength for cont. (AA)</span>
<span class="go">  -CW2 UPPER WAVELENGTH - CONT, --ccut2 UPPER WAVELENGTH - CONT</span>
<span class="go">                        Upper rest-frame wavelength for cont. (AA)</span>
<span class="go">  -ECW1 EXCLUDE FROM CONT. (LOWER WAVELENGTH), --eccut1 EXCLUDE FROM CONT. (LOWER WAVELENGTH)</span>
<span class="go">                        Lower rest-frame wavelength of range to exclude for</span>
<span class="go">                        cont. (AA)</span>
<span class="go">  -ECW2 EXCLUDE FROM CONT. (UPPER WAVELENGTH), --eccut2 EXCLUDE FROM CONT. (UPPER WAVELENGTH)</span>
<span class="go">                        Upper rest-frame wavelength of range to exclude for</span>
<span class="go">                        cont. (AA)</span>
<span class="go">  -PW1 LOWER WAVELENGTH - PLOT, --pcut1 LOWER WAVELENGTH - PLOT</span>
<span class="go">                        Lower rest-frame wavelength for plot (AA)</span>
<span class="go">  -PW2 UPPER WAVELENGTH - PLOT, --pcut2 UPPER WAVELENGTH - PLOT</span>
<span class="go">                        Upper rest-frame wavelength for plot (AA)</span>
<span class="go">  -S2 SCALE FACTOR FOR AMP2, --scale-amp2 SCALE FACTOR FOR AMP2</span>
<span class="go">                        Scale factor for amplitude 2</span>
<span class="go">  -t SPEC-TABLE, --spec-table SPEC-TABLE</span>
<span class="go">                        Additional spectrum table</span>
<span class="go">  -c LINECAT-TABLE, --catalog LINECAT-TABLE</span>
<span class="go">                        Cataloged lines CSV table</span>
<span class="go">  -z REDSHIFT, --redshift REDSHIFT</span>
<span class="go">                        Redshift for target and catalog lines</span>
<span class="go">  -o OUTPUT-PDF, --output OUTPUT-PDF</span>
<span class="go">                        Output PDF</span>
<span class="go">  -p, --plot            Plot spectrum?</span>
<span class="go">  -n, --no-legend       Legend?</span>
</pre></div>
</div>
<p>Some of the options of this task are common to the ones in
<code class="docutils literal notranslate"><span class="pre">megaratools_plot_spectrum</span></code>, including the possibility of adding a tabulated
spectrum (<code class="docutils literal notranslate"><span class="pre">-t</span></code>) or catalog of spectral lines (<code class="docutils literal notranslate"><span class="pre">-c</span></code>), defining the redshift
of the source (<code class="docutils literal notranslate"><span class="pre">-z</span></code>), creating an output PDF (<code class="docutils literal notranslate"><span class="pre">-o</span></code>) with or without legend
(<code class="docutils literal notranslate"><span class="pre">-n</span></code>). Here we show an example of its usage:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>megaratools-analyze_spectrum<span class="w"> </span>-s<span class="w"> </span>test/spectrum.fits<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-f<span class="w"> </span><span class="m">2</span><span class="w"> </span>-w<span class="w"> </span><span class="m">6563</span><span class="w"> </span>-LW1<span class="w"> </span><span class="m">6552</span><span class="w"> </span>-LW2<span class="w"> </span><span class="m">6570</span><span class="w"> </span>-CW1<span class="w"> </span><span class="m">6400</span><span class="w"> </span>-CW2<span class="w"> </span><span class="m">6710</span><span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-ECW1<span class="w"> </span><span class="m">6545</span><span class="w"> </span>-ECW2<span class="w"> </span><span class="m">6588</span><span class="w"> </span>-PW1<span class="w"> </span><span class="m">6350</span><span class="w"> </span>-PW2<span class="w"> </span><span class="m">6800</span><span class="w"> </span>-f<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-c<span class="w"> </span>test/bright_lines.dat<span class="w"> </span>-p<span class="w"> </span>-k<span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;-0.00025&quot;</span><span class="w"> </span>-S2<span class="w"> </span><span class="s2">&quot; -0.2&quot;</span>
</pre></div>
</div>
<p>Note that setting values to <code class="docutils literal notranslate"><span class="pre">-LW1</span></code>, <code class="docutils literal notranslate"><span class="pre">-LW2</span></code>, <code class="docutils literal notranslate"><span class="pre">-CW1</span></code>, <code class="docutils literal notranslate"><span class="pre">-CW2</span></code>, <code class="docutils literal notranslate"><span class="pre">-PW1</span></code>,
<code class="docutils literal notranslate"><span class="pre">-PW2</span></code> is mandatory. The tool, based on some of the options introduced,
determines an initial set of fitting parameters. If the <code class="docutils literal notranslate"><span class="pre">-k</span></code> option is set,
the initial guess on the line peak is taken from the maximum value (after the
best-fitting continuum is removed) within the specified fitting range. For the
initial guesses on the 1<sup>st</sup> and 2<sup>nd</sup>-order moments we take the
position of that maximum and some factor (~1-1.2, depending on the model
function; see below) of the instrumental FWHM. The models considered to date
are:</p>
<ul class="simple">
<li><p>Gauss-Hermite polynomials (<code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">0</span></code>)</p></li>
<li><p>Single gaussian (<code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">1</span></code>)</p></li>
<li><p>Two gaussians (<code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">2</span></code>)</p></li>
</ul>
<p>In the case of the model with two gaussians one can scale the initial
guess on the peak intensity of the second gaussian relative to the first
one. This is particularly useful when underlying absorption is present
in the spectral range of the fit (see <strong>Figure 22</strong>). After executing
this command, it prints in the screen both the input and output
(best-fitting) parameters. The content of this output also depends on
the type of model function chosen to fit the emission line. The output
of the example above would be the following:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>FITTING CONTINUUM:
Input(slope,yord):   0.000E+00  9.724E-14
Output(slope,yord): -5.336E-17  4.468E-13
Best-fitting chisqr continuum:  7.321E-27
BASIC NUMBERS:
(mean,rms,lpk,pk,S/N) 9.682864107165422e-14 2.9143067925725397e-15 6561.03 1.658473599169167e-13 56.907996213575935
FITTING METHOD: DOUBLE GAUSSIAN
Input(i1,l1,sig1,i2,l2,sig2):   6.212E-14 6561.03  0.47 -1.380E-15 6561.03  0.93
Flux1 from model:  8.224E-14+/- 9.845E-15
Flux2 from model: -1.117E-13+/- 9.573E-15
Output(i1,l1,sig1,i2,l2,sig2):  8.308E-14 6561.11  0.39 -1.263E-14 6561.31  3.63
Flux &amp; EW from data:  -2.844E-14+/- 9.690E-15 -0.29+/- 0.10
Flux &amp; EW from model: -2.949E-14+/- 9.689E-15 -0.30+/- 0.10
Best-fitting chisqr:  2.279E-28
</pre></div>
</div>
<p>Note that the term <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">data</span></code> refers to the sum of the flux above the
continuum within the spectral range used to fit the line profile, while
the term <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">model</span></code> refers to the analytic integral of the model.</p>
<p>Besides, <code class="docutils literal notranslate"><span class="pre">megaratools-analyze_spectrum</span></code> displays a plot (similar to the
ones shown in <strong>Figure 22</strong>) that includes:</p>
<ul class="simple">
<li><p>The input spectrum in the range set by options <code class="docutils literal notranslate"><span class="pre">-PW``1</span> <span class="pre">and</span> <span class="pre">``-PW2</span></code> (blue
line)</p></li>
<li><p>Vertical lines of the different spectral ranges of interest, including the
range covered by all fibers (cyan line) and with precise flux calibration in
the original RSS frame (dashed red line), the range for fitting the continuum
(dashed grey lines) and that where the line fit is performed (solid gray
line).</p></li>
<li><p>Best-fitting continuum (solid red line).</p></li>
<li><p>Best-fitting line plus continuum (solid orange line).</p></li>
</ul>
<p>The user should check the ranges chosen and then kill the graphical
terminal for the code to start running.</p>
<p><a class="reference internal" href="_images/image34.png"><img alt="prezoom image14" src="_images/image34.png" style="width: 3.14708in; height: 2.41985in;" /></a><a class="reference internal" href="_images/image35.png"><img alt="image14" src="_images/image35.png" style="width: 3.1087in; height: 2.36637in;" /></a></p>
<p><strong>Figure 22:</strong> Two different views of the plot generated by
megaratools-analyze_spectrum for the example given in the text. In this case
the line fitted is <span class="math notranslate nohighlight">\({\rm H}\alpha\)</span> and the method used was a double
gaussian, where the intensity of the secondary gaussian was set to negative 20%
of the intensity of the primary one to model the underlying absorption in this
(Balmer) line.</p>
</section>
<section id="analysis-of-a-2d-rss-emission-line-spectrum-megaratools-analyze-rss">
<h2>Analysis of a 2D RSS emission-line spectrum: megaratools-analyze_rss<a class="headerlink" href="#analysis-of-a-2d-rss-emission-line-spectrum-megaratools-analyze-rss" title="Link to this heading">ÔÉÅ</a></h2>
<p>Based on the fitting procedure of <code class="docutils literal notranslate"><span class="pre">megaratools-analyze_spectrum</span></code> tool we
also developed a tool that is able to do the same spectral analysis in
MEGARA RSS files. This is particularly useful for creating maps of
derived properties (fluxes, line-of-sight radial velocity and velocity
dispersion and higher-order momenta) from the analysis of LCB RSS final
data (<code class="docutils literal notranslate"><span class="pre">final_rss.fits</span></code> or <code class="docutils literal notranslate"><span class="pre">reduced_rss.fits</span></code> files created by the
<strong>MegaraLcbImage</strong> recipe).</p>
<p>The tool is called <code class="docutils literal notranslate"><span class="pre">megaratools-analyze_rss</span></code> and it is executed by
doing:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>megaratools-analyze_rss<span class="w"> </span>-h
<span class="go">usage: analyze_rss [-h] [-s RSS FILE] [-f FITTING FUNCTION (0,1,2)]</span>
<span class="go">                   [-S MINIMUM S/N] [-w LINE CENTRAL WAVELENGTH] [-k]</span>
<span class="go">                   [-LW1 LOWER WAVELENGTH - LINE]</span>
<span class="go">                   [-LW2 UPPER WAVELENGTH - LINE]</span>
<span class="go">                   [-CW1 LOWER WAVELENGTH - CONT]</span>
<span class="go">                   [-CW2 UPPER WAVELENGTH - CONT]</span>
<span class="go">                   [-ECW1 EXCLUDE FROM CONT. (LOWER WAVELENGTH)]</span>
<span class="go">                   [-ECW2 EXCLUDE FROM CONT. (UPPER WAVELENGTH)]</span>
<span class="go">                   [-PW1 LOWER WAVELENGTH - PLOT]</span>
<span class="go">                   [-PW2 UPPER WAVELENGTH - PLOT] [-S2 SCALE FACTOR FOR AMP2]</span>
<span class="go">                   [-z REDSHIFT] [-o OUTPUT-PDF] [-v] [-O OUTPUT RSS FILE]</span>
<span class="go">                   [-of OUTPUT FIBERS LIST]</span>

<span class="go">     __________________  ANALYZE_RSS PROGRAM  __________________</span>

<span class="go">     ____________  OUTPUT PARAMETER IN OUTPUT FITS  ____________</span>
<span class="go">     Property  channel description</span>

<span class="go">...  FM        #  0 Fitting method (0=gauss-hermite,1=1gauss,2=2gauss)</span>
<span class="go">...  CONTINUUM #  1 Continuum level in cgs</span>
<span class="go">...  NOISE     #  2 rms in cgs</span>
<span class="go">...  SNR       #  3 S/N at the peak of the line</span>
<span class="go">...  FLUXD     #  4 Flux from window_data - window_continuum</span>
<span class="go">...  EWD       #  5 Flux from window_data - window_continuum / mean_continuum</span>
<span class="go">...  FLUXF     #  6 Flux from best-fitting function(s)</span>
<span class="go">...  EWF       #  7 EW from best-fitting function(s)</span>
<span class="go">...  H0        #  8 amplitude for methods 0 &amp; 1 &amp; 2 (first gaussian)</span>
<span class="go">...  H1        #  9 central lambda for methods 0 &amp; 1 &amp; 2 (first gaussian)</span>
<span class="go">...  H2        # 10 sigma (in AA) for methods 0 &amp; 1 &amp; 2 (first gaussian)</span>
<span class="go">...  H3        # 11 h3 for method 0</span>
<span class="go">...  H4        # 12 h4 for method 0</span>
<span class="go">...  H0B       # 13 amplitude for method 2 (second gaussian)</span>
<span class="go">...  H1B       # 14 central lambda for method 2 (second gaussian)  </span>
<span class="go">...  H2B       # 15 sigma (in AA) for method 2 (second gaussian)</span>
<span class="go">...  H1KS      # 16 velocity in km/s from H1 (1st g)</span>
<span class="go">...  H2KS      # 17 sigma in km/s from H2 (1st g)</span>
<span class="go">...  H2KLC     # 18 sigma in km/s from H2 corrected for instrumental sigma (1st g)</span>
<span class="go">...  H1KSB     # 19 velocity in km/s from H1B (2nd g)</span>
<span class="go">...  H2KSB     # 20 sigma in km/s from H2B (2nd g)</span>
<span class="go">...  H2KLCB    # 21 sigma in km/s from H2 corrected for instrumental sigma (2nd g)</span>
<span class="go">...  FLUXF1    # 22 Flux from best-fitting 1st gaussian </span>
<span class="go">...  FLUXF2    # 23 Flux from best-fitting 2nd gaussian </span>
<span class="go">...  EFLUXD    # 24 Error of 4 (Flux from window_data - window_continuum) </span>
<span class="go">...  EEWD      # 25 Error of 5 (Flux from window_data - window_continuum / mean_continuum)</span>
<span class="go">...  EFLUXF    # 26 Error of 6 (Flux from best-fitting function(s))</span>
<span class="go">...  EEWF      # 27 Error of 7 (EW from best-fitting function(s))</span>
<span class="go">...  CHI2      # 28 best-fitting chi^2 (cgs)</span>

<span class="go">options:</span>
<span class="go">  -h, --help            show this help message and exit</span>
<span class="go">  -s RSS FILE, --spectrum RSS FILE</span>
<span class="go">                        RSS input file</span>
<span class="go">  -f FITTING FUNCTION (0,1,2), --method FITTING FUNCTION (0,1,2)</span>
<span class="go">                        Fitting function (0=gauss_hermite, 1=gauss, 2=double_gauss)</span>
<span class="go">  -S MINIMUM S/N, --limsnr MINIMUM S/N</span>
<span class="go">                        Mininum Signal-to-noise ratio in each spaxel</span>
<span class="go">  -w LINE CENTRAL WAVELENGTH, --ctwl LINE CENTRAL WAVELENGTH</span>
<span class="go">                        Central rest-frame wavelength for line (AA)</span>
<span class="go">  -k, --use-peak        Use peak first guess on central wavelength</span>
<span class="go">  -LW1 LOWER WAVELENGTH - LINE, --lcut1 LOWER WAVELENGTH - LINE</span>
<span class="go">                        Lower rest-frame wavelength for line (AA)</span>
<span class="go">  -LW2 UPPER WAVELENGTH - LINE, --lcut2 UPPER WAVELENGTH - LINE</span>
<span class="go">                        Upper rest-frame wavelength for line (AA)</span>
<span class="go">  -CW1 LOWER WAVELENGTH - CONT, --ccut1 LOWER WAVELENGTH - CONT</span>
<span class="go">                        Lower rest-frame wavelength for cont. (AA)</span>
<span class="go">  -CW2 UPPER WAVELENGTH - CONT, --ccut2 UPPER WAVELENGTH - CONT</span>
<span class="go">                        Upper rest-frame wavelength for cont. (AA)</span>
<span class="go">  -ECW1 EXCLUDE FROM CONT. (LOWER WAVELENGTH), --eccut1 EXCLUDE FROM CONT. (LOWER WAVELENGTH)</span>
<span class="go">                        Lower rest-frame wavelength of range to exclude for cont. (AA)</span>
<span class="go">  -ECW2 EXCLUDE FROM CONT. (UPPER WAVELENGTH), --eccut2 EXCLUDE FROM CONT. (UPPER WAVELENGTH)</span>
<span class="go">                        Upper rest-frame wavelength of range to exclude for cont. (AA)</span>
<span class="go">  -PW1 LOWER WAVELENGTH - PLOT, --pcut1 LOWER WAVELENGTH - PLOT</span>
<span class="go">                        Lower (observed) wavelength for plot (AA)</span>
<span class="go">  -PW2 UPPER WAVELENGTH - PLOT, --pcut2 UPPER WAVELENGTH - PLOT</span>
<span class="go">                        Upper (observed) wavelength for plot (AA)</span>
<span class="go">  -S2 SCALE FACTOR FOR AMP2, --scale-amp2 SCALE FACTOR FOR AMP2</span>
<span class="go">                        Scale factor for amplitude 2</span>
<span class="go">  -z REDSHIFT, --redshift REDSHIFT</span>
<span class="go">                        Redshift for target and catalog lines</span>
<span class="go">  -o OUTPUT-PDF, --output OUTPUT-PDF</span>
<span class="go">                        Output PDF</span>
<span class="go">  -v, --verbose         Verbose mode for fitting results?</span>
<span class="go">  -O OUTPUT RSS FILE, --output-rss OUTPUT RSS FILE</span>
<span class="go">                        Output RSS file</span>
<span class="go">  -of OUTPUT FIBERS LIST, --output-fibers OUTPUT FIBERS LIST</span>
<span class="go">                        Output list of fibers above minimum Signal-to-noise ratio</span>
</pre></div>
</div>
<p>Although the spectral ranges and model function set by the options of
the parameter are common to all fibers, option <code class="docutils literal notranslate"><span class="pre">-S</span></code> allows to set a
minimum signal-to-noise ratio for the peak intensity below which no fit
is attempted. The verbose mode allows to print to screen the same output
results as those shown by default by the <code class="docutils literal notranslate"><span class="pre">megaratools-analyze_spectrum</span></code>
tool but for each individual fiber fulfilling the minimum S/N criteria
imposed.</p>
<p>The rest of the options are identical to the ones described for the
<code class="docutils literal notranslate"><span class="pre">megaratools-analysis_spectrum</span></code> tool. The main difference comes from the
output products. While in the case of the <code class="docutils literal notranslate"><span class="pre">megaratools-analysis_spectrum</span></code>
tool only printed output is produced, this tool generates an RSS FITS file of
products that has the same number of rows as the input RSS (623 or 644) but
only 29 columns, one per derived property, including the majority of the model
best-fitting parameters. The properties included in columns 0 to 28 of the
output RSS and their meaning are listed above as part of the online help
information provided by the tool (<code class="docutils literal notranslate"><span class="pre">-h</span></code> option). The output also includes a
PDF file with the graphical result of all fibers that were fit (plots with the
original spectra of fibers with S/N below the number given in option <code class="docutils literal notranslate"><span class="pre">-S</span></code> are
also included) and an ascii file listing the ids of the fibers that matched our
minimum S/N requirement. This file is useful as it can be used (in combination
with <code class="docutils literal notranslate"><span class="pre">megaratools-extract_spectrum</span></code>) to generate a high-S/N emission-line
spectrum of our target. <strong>Figure 23</strong> shows the plots generated for two
specific fibers and two different spectral lines using the instructions given
later in this section.</p>
<p>Below we provide two examples of the execution of the
<code class="docutils literal notranslate"><span class="pre">megaratools-analyzed_rss</span></code> tool for two different spectral lines in the
same spectral setup: <span class="math notranslate nohighlight">\({\rm H}\alpha\)</span> and <span class="math notranslate nohighlight">\([{\rm NII}]\lambda
6584\)</span>. Right after each of these
commands is executed, the program shows a plot of the integrated
spectrum (all fiber spectra added up) with all relevant spectral ranges
clearly identified with vertical lines. The RSS product files generated
by these two instructions will be later used to compute an RSS file that
can be used to create a line-ratio map.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>megaratools-analyze_rss<span class="w"> </span>-s<span class="w"> </span>test/final_rss.fits<span class="w"> </span>-f<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-w<span class="w"> </span><span class="m">6563</span><span class="w"> </span>-LW1<span class="w"> </span><span class="m">6552</span><span class="w"> </span>-LW2<span class="w"> </span><span class="m">6570</span><span class="w"> </span>-CW1<span class="w"> </span><span class="m">6400</span><span class="w"> </span>-CW2<span class="w"> </span><span class="m">6710</span><span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-ECW1<span class="w"> </span><span class="m">6545</span>.<span class="w"> </span>-ECW2<span class="w"> </span><span class="m">6588</span><span class="w"> </span>-PW1<span class="w"> </span><span class="m">6350</span><span class="w"> </span>-PW2<span class="w"> </span><span class="m">6800</span><span class="w"> </span>-f<span class="w"> </span><span class="m">2</span><span class="w"> </span>-k<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-z<span class="w"> </span><span class="s2">&quot;-0.00025&quot;</span><span class="w"> </span>-S2<span class="w"> </span><span class="s2">&quot; -0.2&quot;</span><span class="w"> </span>-S<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-o<span class="w"> </span>test/analyze_rss_Halpha.pdf<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-O<span class="w"> </span>test/analyze_rss_Halpha.fits<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-of<span class="w"> </span>test/analyze_rss_Halpha.fibers

<span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>megaratools-analyze_rss<span class="w"> </span>-s<span class="w"> </span>test/final_rss.fits<span class="w"> </span>-f<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-w<span class="w"> </span><span class="m">6584</span><span class="w"> </span>-LW1<span class="w"> </span><span class="m">6580</span><span class="w"> </span>-LW2<span class="w"> </span><span class="m">6587</span><span class="w"> </span>-CW1<span class="w"> </span><span class="m">6400</span><span class="w"> </span>-CW2<span class="w"> </span><span class="m">6710</span><span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-ECW1<span class="w"> </span><span class="m">6545</span>.<span class="w"> </span>-ECW2<span class="w"> </span><span class="m">6588</span><span class="w"> </span>-PW1<span class="w"> </span><span class="m">6350</span><span class="w"> </span>-PW2<span class="w"> </span><span class="m">6800</span><span class="w"> </span>-f<span class="w"> </span><span class="m">1</span><span class="w"> </span>-k<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-z<span class="w"> </span><span class="s2">&quot;-0.00025&quot;</span><span class="w"> </span>-S<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-o<span class="w"> </span>test/analyze_rss_N2.pdf<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-O<span class="w"> </span>test/analyze_rss_N2.fits<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-of<span class="w"> </span>test/analyze_rss_N2.fibers
</pre></div>
</div>
<p><a class="reference internal" href="_images/image36.png"><img alt="image15" src="_images/image36.png" style="width: 3.59647in; height: 2.66927in;" /></a><a class="reference internal" href="_images/image37.png"><img alt="image16" src="_images/image37.png" style="width: 3.5784in; height: 2.70836in;" /></a></p>
<p><strong>Figure 23:</strong> Results of the fitting of <span class="math notranslate nohighlight">\({\rm H}\alpha\)</span> (left panel) and
<span class="math notranslate nohighlight">\([{\rm NII}]\lambda6584\)</span> (right panel) spectral lines for fibers 291 and
321, respectively. As for the graphical output of megaratools-analyze_spectrum,
the input spectrum is shown in blue, the range used for the fitting the
continuum is bracketed between dashed grey lines, the range for fitting the
line in between solid grey lines, the best-fitting continuum is shown as a
solid red line and the best-fitting line plus continuum is in orange.</p>
</section>
<section id="rss-arithmetics-megaratools-rss-arith">
<h2>RSS arithmetics: megaratools-rss_arith<a class="headerlink" href="#rss-arithmetics-megaratools-rss-arith" title="Link to this heading">ÔÉÅ</a></h2>
<p>The tool <code class="docutils literal notranslate"><span class="pre">megaratools-rss_arith</span></code> described here allows to perform basic
computations (Python basic arithmetic and <strong>numpy</strong> numerical operations)
on RSS files. The online help output is shown below.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>megaratools-rss_arith<span class="w"> </span>-h
<span class="go">usage: combine_rss [-h] [-e Equation to evaluate] [-o OUTPUT RSS] rss</span>

<span class="go">Combining by averaging aligned RSS files</span>

<span class="go">positional arguments:</span>
<span class="go">  rss                   Input table with list of RSS files</span>

<span class="go">options:</span>
<span class="go">  -h, --help            show this help message and exit</span>
<span class="go">  -e Equation to evaluate, --equation Equation to evaluate</span>
<span class="go">                        Example: &#39;(ima1[:,9] + ima2[:,10])/ ima3[:,3]&#39;</span>
<span class="go">  -o OUTPUT RSS, --output OUTPUT RSS</span>
<span class="go">                        Output RSS</span>
</pre></div>
</div>
<p>The input of this tool is a text file with the list of images involved
in the operation (all of the same size):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>cat<span class="w"> </span>test/images.txt
<span class="go">test/analyze_rss_N2.fits</span>
<span class="go">test/analyze_rss_Halpha.fits</span>
<span class="go">test/final_rss.fits</span>
</pre></div>
</div>
<p>The output is always an RSS file with one single column and the same
number of rows as the input images. The philosophy behind of this tool
is rather similar to that of the <strong>imexpr</strong> command in IRAF.</p>
<p>The tool can be used for multiple purposes using any of the <strong>numpy</strong>
array operations. Below we show examples of some potential usages of
<code class="docutils literal notranslate"><span class="pre">megaratools-rss_arith</span></code>. For example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>megaratools-rss_arith<span class="w"> </span>test/images.txt<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-e<span class="w"> </span><span class="s1">&#39;np.log10(ima1[:,6]/ima2[:,22])&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-o<span class="w"> </span>test/logN2_over_Ha_rss.fits
</pre></div>
</div>
<p>This instruction includes the options required to create a line-ratio RSS (in
log10 scale) from two RSS FITS files created by the <code class="docutils literal notranslate"><span class="pre">megaratools-analyze_rss</span></code>
tool for the <span class="math notranslate nohighlight">\({\rm H}\alpha\)</span> and <span class="math notranslate nohighlight">\([{\rm NII}\lambda6584]\)</span> lines.
Note that, given that we are using only the flux of the emission component of
<span class="math notranslate nohighlight">\({\rm H}\alpha\)</span>,¬†we use channel #22, which corresponds to the line flux
of only the primary gaussian (see description of tool
<code class="docutils literal notranslate"><span class="pre">megaratools-analyze_rss</span></code> in Section 6.8), for <span class="math notranslate nohighlight">\({\rm H}\alpha\)</span>¬†and
channel #6 for <span class="math notranslate nohighlight">\([{\rm NII}\lambda6584]\)</span>.</p>
<p>Other examples are:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>megaratools-rss_arith<span class="w"> </span>test/images.txt<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-e<span class="w"> </span><span class="s1">&#39;(np.mean(ima3[:,1000:2000],axis=1))&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-o<span class="w"> </span>test/mean_1000_2000.fits

<span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>megaratools-rss_arith<span class="w"> </span>test/images.txt<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-e<span class="w"> </span><span class="s1">&#39;(np.mean(ima3[:,2000:3000],axis=1))&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-o<span class="w"> </span>test/mean_2000_3000.fits
</pre></div>
</div>
<p>In these cases, we compute the mean of all the flux from spectral pixels
1000 to 2000 (top) and 2000 to 3000 (bottom) to create two new separated
RSS files. We can now create a spectral-index-like RSS image by running:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>megaratools-rss_arith<span class="w"> </span>test/images2.txt<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-e<span class="w"> </span><span class="s1">&#39;ima4[:,0]/ima5[:,0]&#39;</span><span class="w"> </span>-o<span class="w"> </span>test/index.fits
</pre></div>
</div>
<p>The user should bear in mind that <code class="docutils literal notranslate"><span class="pre">test/images2.txt</span></code> now includes two
additional rows with the names of the images created above:
<code class="docutils literal notranslate"><span class="pre">test/mean_1000_2000.fits</span></code> and <code class="docutils literal notranslate"><span class="pre">test/mean_2000_3000.fits</span></code>. Note that
although the images listed in the <code class="docutils literal notranslate"><span class="pre">test/images2.txt</span></code> file would have
different dimensions we would not get any error because (1) they have
the same number of rows (623 in this case) and (2) images of different
dimensions are not combined in the same execution of
<code class="docutils literal notranslate"><span class="pre">megaratoos-rss_arith</span></code>. We show in <strong>Figure 24</strong> the resulting
<code class="docutils literal notranslate"><span class="pre">test/index.fits</span></code> RSS image using the <code class="docutils literal notranslate"><span class="pre">megaradrp.visualization</span></code> tool
described in Section 6.1. This figure was obtained using the command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>megaradrp.visualization<span class="w"> </span>test/index.fits<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-c<span class="w"> </span><span class="m">0</span><span class="w"> </span>--min-cut<span class="w"> </span><span class="m">0</span>.8<span class="w"> </span>--max-cut<span class="w"> </span><span class="m">1</span>.2
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/image38.png"><img alt="_images/image38.png" src="_images/image38.png" style="width: 4.42014in; height: 3.06806in;" />
</a>
<p><strong>Figure 24:</strong> Ratio between the <code class="docutils literal notranslate"><span class="pre">mean_1000_2000.fits</span></code> and
<code class="docutils literal notranslate"><span class="pre">mean_2000_3000.fits</span></code> images generated with <code class="docutils literal notranslate"><span class="pre">megaratools-rss_arith</span></code>.</p>
<p>Note that the spectral range explored by this spectral-index image is
rather small, which leads to a very small dynamic range. Nevertheless,
most of the spaxels showing bright emission from the source reveal a
relatively blue color as expected for the spectral type of this
spectrophotometric standard star.</p>
<p>The user should be also aware when using this tool that any operation
involving a logarithmic or intensity ratios might lead to some warnings.
These tools should properly handle (and create when necessary) NaN
values but we cannot guarantee that any other software to be run on
these products will have no issues using these data.</p>
<p>We note that <code class="docutils literal notranslate"><span class="pre">megaratools-rss_arith</span></code> can be also used on extracted (1D)
spectra created with the <code class="docutils literal notranslate"><span class="pre">megaratools-extract_spectrum</span></code> tool described
in Section 6.3. The instruction to use it on extracted spectra would be
something like the following:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>megaratools-rss_arith<span class="w"> </span>test/list_1D<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-e<span class="w"> </span><span class="s1">&#39;2.0*ima1+ima2&#39;</span><span class="w"> </span>-o<span class="w"> </span>test/output_1D.fits
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">list_1D</span></code> should be a text ascii file with the (in this case, two)
extracted spectra on which the numerical operation is to be performed
(similar to the <code class="docutils literal notranslate"><span class="pre">test/images.txt</span></code> file quoted above for RSS files) and
<code class="docutils literal notranslate"><span class="pre">output_1D.fits</span></code> would be the output 1D spectrum. This output file is
fully compatible with our <code class="docutils literal notranslate"><span class="pre">megaratools-plot_spectrum</span></code> or
<code class="docutils literal notranslate"><span class="pre">megaratools-analyze_spectrum</span></code> tools.</p>
</section>
<section id="megaratools-hypercube">
<h2>Megaratools-hypercube<a class="headerlink" href="#megaratools-hypercube" title="Link to this heading">ÔÉÅ</a></h2>
<p>Some observations with the MEGARA LCB might require of acquiring
multiple points to mosaic an extended astrophysical object. In order to
combine the information from all the different RSS files generated by
the DRP from each of the individual observations we have developed a
code based on the <code class="docutils literal notranslate"><span class="pre">megaradrp-cube</span></code> tool but that is able to handle a
series of RSS files placed at different adjacent positions in the sky
combined them all together to create a single large cube. This tool is
called <code class="docutils literal notranslate"><span class="pre">megaratools-hypercube</span></code> and its online help can be obtained by
doing:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>megaratools-hypercube<span class="w"> </span>-h
<span class="go">usage: convert_rss_cube [-h] [-l] [-c] [-p PIXEL_SIZE] [-o OUTFILE] [-d]</span>
<span class="go">                        [-m {nn,linear}] [--wcs-pa-from-header] [-trim] [-hyp]</span>
<span class="go">                        [-helio] [-trimn [TRIMMING_NUMBERS ...]]</span>
<span class="go">                        rss</span>

<span class="go">positional arguments:</span>
<span class="go">  rss                   RSS file / List of RSS files</span>

<span class="go">options:</span>
<span class="go">  -h, --help            show this help message and exit</span>
<span class="go">  -l, --is-a-list       Use for -s being a list of FITS spectra</span>
<span class="go">  -c, --is-a-cube       Use for -s being a list of cubes (not rss) spectra</span>
<span class="go">  -p PIXEL_SIZE, --pixel-size PIXEL_SIZE</span>
<span class="go">                        Pixel size in arc seconds (default = 0.4)</span>
<span class="go">  -o OUTFILE, --outfile OUTFILE</span>
<span class="go">                        Name of the output cube file (default = test</span>
<span class="go">  -d, --disable-scaling</span>
<span class="go">                        Disable flux conservation</span>
<span class="go">  -m {nn,linear}, --method {nn,linear}</span>
<span class="go">                        Method of interpolation</span>
<span class="go">  --wcs-pa-from-header  Use PA angle from header</span>
<span class="go">  -trim, --trimming     Use for trimming the cubes</span>
<span class="go">  -hyp, --hyper         Use for creating the hypercube</span>
<span class="go">  -helio, --helio       Use for applying heliocentric velocity correction</span>
<span class="go">  -trimn [TRIMMING_NUMBERS ...], --trimming-numbers [TRIMMING_NUMBERS ...]</span>
<span class="go">                        Use for declare the number of rows and columns you</span>
<span class="go">                        want to trim. [Bottom rows, top rows, left column,</span>
<span class="go">                        right column] (default= 1,2,1,1)</span>
</pre></div>
</div>
<p>Although this tool determines the position on the sky based on the image
WCS solution, it also allows to apply additional RA &amp; Dec offsets to
each of the individual generated cube sections (one from input RSS
frame). Besides, one can also shift and scale the flux levels of each of
the cube sections to take into account possible non-photometric
conditions during the observation. These corrections are introduced as
part of the input file where the list of RSS images to combine are
included. An example of such a file is given below:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>cat<span class="w"> </span>test/list_hypercube
<span class="go">test/reduced_rss_OB0001_B.fits 0.0 0.0 0.0 1.0</span>
<span class="go">test/reduced_rss_OB0002_B.fits 0.0 0.0 0.0 1.0</span>
<span class="go">test/reduced_rss_OB0003_B.fits 0.0 0.0 0.0 1.0</span>
<span class="go">test/reduced_rss_OB0004_B.fits 0.0 0.0 0.0 1.0</span>
</pre></div>
</div>
<p>The first column is the RSS filename, columns 2 and 3 correspond to the
offsets (in arcsec) of the different pointings, column 4 allows to
introduce offsets to the flux levels measured in the corresponding
pointing and column 5 is the scaling factor to be applied to the flux of
each pointing. The example listed above would be the one to be used if
the astrometry and flux calibration of all RSS files is perfect.</p>
<p>An example of how the tool should be run would be the following:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(megara)</span> <span class="gp">$ </span>megaratools-hypercube<span class="w"> </span>test/list_hypercube<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>-l<span class="w"> </span>-o<span class="w"> </span>test/cube.fits<span class="w"> </span>-p<span class="w"> </span><span class="m">0</span>.4<span class="w"> </span>-m<span class="w"> </span>linear<span class="w"> </span>--wcs-pa-from-header<span class="w"> </span>-trim<span class="w"> </span>-hyp<span class="w"> </span>-helio
</pre></div>
</div>
<p>In this case the pixel size of the <code class="docutils literal notranslate"><span class="pre">cube.fits</span></code> output file would be 0.4
arcsec/pixel, the cube would be generated using linear interpolation, 2
two rows and 1 bottom row, 1 left and right columns would be removed
from each cube before they are combined together. The best number of
rows and columns to be removed depends on the pixel size, so it can be
modified by using the -trimn option. Besides,
<code class="docutils literal notranslate"><span class="pre">megaradrp-tools_hypercube</span></code> allows to put all (topocentric) wavelength
calibrations to a common barycenter wavelength calibration.</p>
<p>The use can also use this tool to simply generate a list of cubes from
individual RSS files by removing the <code class="docutils literal notranslate"><span class="pre">-hyp</span></code> option.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="healtraces.html" class="btn btn-neutral float-left" title="Healing Defective Traces" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="issues.html" class="btn btn-neutral float-right" title="Known ISSUES" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2025, Universidad Complutense de Madrid.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>