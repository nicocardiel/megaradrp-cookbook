****************
Data description
****************

In order to help the user in understanding the different execution steps
of the MEGARA DRP, we describe in this section the characteristics of
the main products, including input raw images and pipeline products
(images and tables).

Raw Data
========

Raw data includes all FITS frames delivered to the user by GTC. These
FITS images are 4196 x 4212 pixels in size have two extensions, the
first one including the data themselves and the second one providing all
the information about the fibers (positions in the sky, bundle to which
they belong and whether they are devoted to the observation of target or
sky). Among these images one can find bias frames (as they are obtained
with the **MegaraBiasImage** observing mode they include the name of this
mode it their filename), fiber-flat images (obtained with either the
**MegaraTraceMap** or the **MegaraFiberFlatImage** observing modes), ThAr or
ThNe HCL lamp spectra (obtained with the **MegaraArcCalibration** observing
mode) and scientific observations with either the LCB (**MegaraLcbImage** or
**MegaraLcbAcquisition**; this latter mode is commonly used when the target
is a bright star, normally a spectrophotometric standard star) or the
MOS (**MegaraMosImage**).

Pipeline Products
=================

There are multiple types of products generated by the MEGARA DRP
although they can be grouped in full-frame FITS images of 4096 x 4112
pixels in size (after the overscan+prescan regions are removed from the
raw images), RSS images of 4300 x 623 (for LCB) or 4300 x 644 (for MOS)
pixels, and structured data, which is in most cases are given in files
of JSON format. Below we list the different products within these three
groups along with the recipe that generates them.

Full-frame FITS image products
------------------------------

-  ``master_bias.fits`` (**MasterBiasImage**): Final image of the
   MasterBiasImage recipe.

-  ``reduced_image.fits`` (**MegaraDarkImage**, **MasterTraceMap**,
   **MegaraModelMap**, **MegaraFiberFlatImage**, **MegaraArcCalibration**,
   **MegaraTwilightFlatImage**, **MegaraLcbStdStar**, **MegaraLcbAcquisition**,
   **MegaraLcbImage**, **MegaraMosImage**, **MegaraArcCalibration**): Final
   image after all individual exposures have been processed and combined.

-  ``master_slitflat.fits`` (**MegaraSlitFlat**): Image obtained by
   observing a continuum-lamp light with the spectrograph out of its
   optimal focus. The level of de-focusing should be enough to ensure a
   uniform illumination through the entire CCD but keeping the
   wavelength of the light approximately the same at each given pixel
   that when the instrument is well focused.

-  ``fwhm_image.fits`` (**MegaraArcCalibration**): Voronoi map of the FWHM
   derived from the fits to the Gaussian profiles of all spectral lines
   identified in the arc-lamp image.

RSS FITS image products
-----------------------

-  ``master_fiberflat.fits`` (**MegaraFiberFlatImage**): Image to be applied
   to correct for variations in sensitivity in between fibers and from
   blue-to-red within each fiber.

-  ``master_twilightflat.fits`` (**MegaraTwilightFlatImage**): Image to be
   applied to correct for the effect of illumination introduced by the
   fiber-flat image when this was obtained through the FC-F ICM and
   differences between the pupil of the ICM and the GTC pupil when the
   object was observed. The values of the twilight-flat image are
   identical for all wavelengths but different from fiber to fiber
   (blue-to-red sensitivity variations were corrected with the
   fiber-flat image).

-  ``reduced_rss.fits`` (**MegaraLcbAcquisition**, **MegaraLcbStdStar**,
   **MegaraLcbImage**, **MegaraMosImage**, **MegaraArcCalibration**): Processed
   image prior to the subtraction of the sky spectrum.

-  ``sky_rss.fits`` (**MegaraLcbAcquisition**, **MegaraLcbStdStar**,
   **MegaraLcbImage**, **MegaraMosImage**, **MegaraArcCalibration**): RSS image
   showing signal only in the valid sky fibers. All other pixels are set
   to zero.

-  ``final_rss.fits`` (**MegaraLcbAcquisition**, **MegaraLcbStdStar**,
   **MegaraLcbImage**, **MegaraMosImage**, **MegaraArcCalibration**): Processed
   image after the subtraction of the sky spectrum is performed. In the
   case of the MOS, this image includes an extension of 92 rows by 4300
   columns where all 7 fibers of each minibundle have been added
   together.

Structured products
-------------------

-  ``master_wlcalib.json`` (**MegaraArcCalibration**): File with the
   information on the wavelength calibration solution for every
   fiber.

-  ``master_traces.json`` (**MasterTraceMap**): File with the tracing
   information.

-  ``master_model.json`` (**MasterModelMap**): File with the information on
   how to account for the cross-talk between adjacent fibers in the
   detector.

In the case of the **MegaraLcbStdStar** recipe, the MEGARA DRP also
generates two different 1D spectra, that of the standard star obtained
after extracting the 37 spaxels around the centroid identified in the
observation-result file (``star_spectrum.fits``) and also the resulting
sensitivity function (``master_sentivity.fits``).

In addition to all these files, the results directory of every recipe
includes also a file named ``task.yaml`` (file with the description of the
execution of the recipe), the file ``result.yaml`` (names of the files
resulting from the recipe and some quality-control information) and the
``processing.log`` logging file.

Besides ds9/SAOimage or similar software packages, the FITS products
generated by the MEGARA DRP can be also visualized using the tool
``numina-ximshow`` distributed as part of **numina**.

